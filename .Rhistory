geom_line(linewidth = 1) +
geom_point(size = 2) +
geom_text(aes(label = round(avg_fare, 2)), vjust = -0.5, size = 3) +
labs(title = "–°–µ—Ä–µ–¥–Ω—è –æ–ø–ª–∞—Ç–∞ –ø–æ –º—ñ—Å—è—Ü—è—Ö", x = "–ú—ñ—Å—è—Ü—å", y = "–°–µ—Ä–µ–¥–Ω—è –æ–ø–ª–∞—Ç–∞") +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1),
legend.position = "none")
# 6. –û–±'—î–¥–Ω–∞–Ω–Ω—è –≥—Ä–∞—Ñ—ñ–∫—ñ–≤
combined_plot <- month_plot / season_plot + plot_layout(guides = "collect") &
theme(legend.position = "bottom")
# 7. –ü—ñ–∫–æ–≤—ñ –≥–æ–¥–∏–Ω–∏ —Ç–∞ –¥–Ω—ñ —Ç–∏–∂–Ω—è
nyc_peaks <- nyc |>
mutate(
month_name = month.abb[month],
season = case_when(
month %in% c(12, 1, 2)  ~ "Winter",
month %in% c(3, 4, 5)   ~ "Spring",
month %in% c(6, 7, 8)   ~ "Summer",
month %in% c(9, 10, 11) ~ "Autumn"
),
hour = hour(pickup_datetime),
day_of_week = wday(pickup_datetime, label = TRUE)
) |>
collect()
# ‚ö°Ô∏è –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ –∑ –¥–∏—Å–∫–∞ —Ç—ñ–ª—å–∫–∏ –ø–æ—Ç—Ä—ñ–±–Ω—ñ –∫–æ–ª–æ–Ω–∫–∏
nyc_peaks <- nyc |>
select(pickup_datetime, month) |>
filter(!is.na(pickup_datetime), !is.na(month)) |>
collect() |>   # ‚¨ÖÔ∏è –ª–∏—à–µ —Ü—ñ 2 –∫–æ–ª–æ–Ω–∫–∏ –≤ –ø–∞–º‚Äô—è—Ç—å
mutate(
season = case_when(
month %in% c(12, 1, 2)  ~ "Winter",
month %in% c(3, 4, 5)   ~ "Spring",
month %in% c(6, 7, 8)   ~ "Summer",
month %in% c(9, 10, 11) ~ "Autumn"
),
hour = lubridate::hour(pickup_datetime),
day_of_week = lubridate::wday(pickup_datetime, label = TRUE)
)
# üîπ –ü—ñ–¥—Ä–∞—Ö—É–Ω–æ–∫ –ø–æ –≥–æ–¥–∏–Ω–∞—Ö
hourly_all <- nyc_peaks |>
group_by(season, hour) |>
summarise(n_trips = n(), .groups = "drop")
# üîπ –ü—ñ–¥—Ä–∞—Ö—É–Ω–æ–∫ –ø–æ –¥–Ω—è—Ö —Ç–∏–∂–Ω—è
daily_all <- nyc_peaks |>
group_by(season, day_of_week) |>
summarise(n_trips = n(), .groups = "drop")
# üîπ –ü–æ–±—É–¥–æ–≤–∞ –≥—Ä–∞—Ñ—ñ–∫—ñ–≤
hour_plot <- ggplot(hourly_all, aes(x = factor(hour), y = n_trips, fill = season)) +
geom_col(position = "dodge") +
labs(title = "–ü—ñ–∫–æ–≤—ñ –≥–æ–¥–∏–Ω–∏ –ø–æ —Å–µ–∑–æ–Ω–∞—Ö", x = "–ì–æ–¥–∏–Ω–∞", y = "–ö—ñ–ª—å–∫—ñ—Å—Ç—å –ø–æ—ó–∑–¥–æ–∫") +
theme_minimal() +
scale_fill_manual(values = c("tan1", "palegreen", "khaki1", "lightblue1"))
day_plot <- ggplot(daily_all, aes(x = day_of_week, y = n_trips, fill = season)) +
geom_col(position = "dodge") +
labs(title = "–ü—ñ–∫–æ–≤—ñ –¥–Ω—ñ —Ç–∏–∂–Ω—è –ø–æ —Å–µ–∑–æ–Ω–∞—Ö", x = "–î–µ–Ω—å —Ç–∏–∂–Ω—è", y = "–ö—ñ–ª—å–∫—ñ—Å—Ç—å –ø–æ—ó–∑–¥–æ–∫") +
theme_minimal() +
scale_fill_manual(values = c("tan1", "palegreen", "khaki1", "lightblue1"))
peak_plot <- hour_plot / day_plot + plot_layout(guides = "collect") &
theme(legend.position = "bottom")
peak_plot
season_summary <- monthly_summary |>
group_by(vendor_name, season) |>
summarise(
avg_distance = sum(avg_distance * n_trips) / sum(n_trips),
avg_fare     = sum(avg_fare * n_trips) / sum(n_trips),
total_trips  = sum(n_trips),
.groups = "drop"
)
season_plot <- ggplot(season_summary,
aes(x = factor(season, levels = c("Winter", "Spring", "Summer", "Autumn")),
y = avg_fare, group = vendor_name, color = vendor_name)) +
geom_line(linewidth = 1) +
geom_point(size = 2) +
geom_text(aes(label = round(avg_fare, 2)), vjust = -1, size = 3) +
labs(x = "–°–µ–∑–æ–Ω", y = "–°–µ—Ä–µ–¥–Ω—è –æ–ø–ª–∞—Ç–∞") +
theme_minimal()
month_plot <- ggplot(monthly_summary,
aes(x = factor(month_name, levels = month.abb),
y = avg_fare, group = vendor_name, color = vendor_name)) +
geom_line(linewidth = 1) +
geom_point(size = 2) +
geom_text(aes(label = round(avg_fare, 2)), vjust = -0.5, size = 3) +
labs(title = "–°–µ—Ä–µ–¥–Ω—è –æ–ø–ª–∞—Ç–∞ –ø–æ –º—ñ—Å—è—Ü—è—Ö", x = "–ú—ñ—Å—è—Ü—å", y = "–°–µ—Ä–µ–¥–Ω—è –æ–ø–ª–∞—Ç–∞") +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1),
legend.position = "none")
combined_plot <- month_plot / season_plot + plot_layout(guides = "collect") &
theme(legend.position = "bottom")
combined_plot
month_plot <- ggplot(monthly_summary,
aes(x = factor(month_name, levels = month.abb),
y = avg_fare, group = vendor_name, color = vendor_name)) +
geom_line(linewidth = 1) +
geom_point(size = 2) +
geom_text(aes(label = round(avg_fare, 2)), vjust = -0.5, size = 3) +
labs(title = "–°–µ—Ä–µ–¥–Ω—è –æ–ø–ª–∞—Ç–∞ –ø–æ –º—ñ—Å—è—Ü—è—Ö", x = "–ú—ñ—Å—è—Ü—å", y = "–°–µ—Ä–µ–¥–Ω—è –æ–ø–ª–∞—Ç–∞") +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
combined_plot <- month_plot / season_plot + plot_layout(guides = "collect") &
theme(legend.position = "bottom")
season_plot <- ggplot(season_summary,
aes(x = factor(season, levels = c("Winter", "Spring", "Summer", "Autumn")),
y = avg_fare, group = vendor_name, color = vendor_name)) +
geom_line(linewidth = 1) +
geom_point(size = 2) +
geom_text(aes(label = round(avg_fare, 2)), vjust = -1, size = 3) +
labs(x = "–°–µ–∑–æ–Ω", y = "–°–µ—Ä–µ–¥–Ω—è –æ–ø–ª–∞—Ç–∞") +
theme_minimal()
month_plot <- ggplot(monthly_summary,
aes(x = factor(month_name, levels = month.abb),
y = avg_fare, group = vendor_name, color = vendor_name)) +
geom_line(linewidth = 1) +
geom_point(size = 2) +
geom_text(aes(label = round(avg_fare, 2)), vjust = -0.5, size = 3) +
labs(title = "–°–µ—Ä–µ–¥–Ω—è –æ–ø–ª–∞—Ç–∞ –ø–æ –º—ñ—Å—è—Ü—è—Ö", x = "–ú—ñ—Å—è—Ü—å", y = "–°–µ—Ä–µ–¥–Ω—è –æ–ø–ª–∞—Ç–∞") +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
combined_plot <- month_plot / season_plot + plot_layout(guides = "collect") &
theme(legend.position = "bottom")
combined_plot <- (month_plot + season_plot) +
plot_layout(guides = "collect") &
theme(legend.position = "bottom")
combined_plot
combined_plot <- month_plot / season_plot + plot_layout(guides = "collect") &
theme(legend.position = "bottom")
combined_plot
color_palette <- c("darkorange", "steelblue", "seagreen", "orchid")
month_plot <- ggplot(monthly_summary,
aes(x = factor(month_name, levels = month.abb),
y = avg_fare, group = vendor_name, color = vendor_name)) +
geom_line(linewidth = 1) +
geom_point(size = 2) +
geom_text(aes(label = round(avg_fare, 2)), vjust = -0.5, size = 3) +
scale_color_manual(values = color_palette, name = "–ü–µ—Ä–µ–≤—ñ–∑–Ω–∏–∫") +
labs(title = "–°–µ—Ä–µ–¥–Ω—è –æ–ø–ª–∞—Ç–∞ –ø–æ –º—ñ—Å—è—Ü—è—Ö", x = "–ú—ñ—Å—è—Ü—å", y = "–°–µ—Ä–µ–¥–Ω—è –æ–ø–ª–∞—Ç–∞") +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
season_plot <- ggplot(season_summary,
aes(x = factor(season, levels = c("Winter", "Spring", "Summer", "Autumn")),
y = avg_fare, group = vendor_name, color = vendor_name)) +
geom_line(linewidth = 1) +
geom_point(size = 2) +
geom_text(aes(label = round(avg_fare, 2)), vjust = -1, size = 3) +
scale_color_manual(values = color_palette, name = "–ü–µ—Ä–µ–≤—ñ–∑–Ω–∏–∫") +
labs(x = "–°–µ–∑–æ–Ω", y = "–°–µ—Ä–µ–¥–Ω—è –æ–ø–ª–∞—Ç–∞") +
theme_minimal()
combined_plot <- month_plot / season_plot +
plot_layout(guides = "collect") &
theme(legend.position = "bottom")
combined_plot
color_palette <- c("darkorange", "steelblue")
month_plot <- ggplot(monthly_summary,
aes(x = factor(month_name, levels = month.abb),
y = avg_fare, group = vendor_name, color = vendor_name)) +
geom_line(linewidth = 1) +
geom_point(size = 2) +
geom_text(aes(label = round(avg_fare, 2)), vjust = -0.5, size = 3) +
labs(title = "–°–µ—Ä–µ–¥–Ω—è –æ–ø–ª–∞—Ç–∞ –ø–æ –º—ñ—Å—è—Ü—è—Ö", x = "–ú—ñ—Å—è—Ü—å", y = "–°–µ—Ä–µ–¥–Ω—è –æ–ø–ª–∞—Ç–∞") +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
season_plot <- ggplot(season_summary,
aes(x = factor(season, levels = c("Winter", "Spring", "Summer", "Autumn")),
y = avg_fare, group = vendor_name, color = vendor_name)) +
geom_line(linewidth = 1) +
geom_point(size = 2) +
geom_text(aes(label = round(avg_fare, 2)), vjust = -1, size = 3) +
labs(x = "–°–µ–∑–æ–Ω", y = "–°–µ—Ä–µ–¥–Ω—è –æ–ø–ª–∞—Ç–∞") +
theme_minimal()
# ‚¨áÔ∏è –æ–±‚Äô—î–¥–Ω–∞–Ω–Ω—è –∑ –æ–¥–Ω—ñ—î—é –ª–µ–≥–µ–Ω–¥–æ—é
combined_plot <- month_plot / season_plot +
plot_layout(guides = "collect") &
scale_color_manual(values = color_palette, name = "–ü–µ—Ä–µ–≤—ñ–∑–Ω–∏–∫") &
theme(legend.position = "bottom")
combined_plot
month_plot <- ggplot(monthly_summary,
aes(x = factor(month_name, levels = month.abb),
y = avg_fare, group = vendor_name, color = vendor_name)) +
geom_line(linewidth = 1) +
geom_point(size = 2) +
geom_text(aes(label = round(avg_fare, 2)), vjust = -0.5, size = 3) +
labs(title = "–°–µ—Ä–µ–¥–Ω—è –æ–ø–ª–∞—Ç–∞ –ø–æ –º—ñ—Å—è—Ü—è—Ö", x = "–ú—ñ—Å—è—Ü—å", y = "–°–µ—Ä–µ–¥–Ω—è –æ–ø–ª–∞—Ç–∞") +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position = "none")
season_plot <- ggplot(season_summary,
aes(x = factor(season, levels = c("Winter", "Spring", "Summer", "Autumn")),
y = avg_fare, group = vendor_name, color = vendor_name)) +
geom_line(linewidth = 1) +
geom_point(size = 2) +
geom_text(aes(label = round(avg_fare, 2)), vjust = -1, size = 3) +
labs(x = "–°–µ–∑–æ–Ω", y = "–°–µ—Ä–µ–¥–Ω—è –æ–ø–ª–∞—Ç–∞") +
theme_minimal()
# ‚¨áÔ∏è –æ–±‚Äô—î–¥–Ω–∞–Ω–Ω—è –∑ –æ–¥–Ω—ñ—î—é –ª–µ–≥–µ–Ω–¥–æ—é
combined_plot <- month_plot / season_plot +
plot_layout(guides = "collect") &
scale_color_manual(values = color_palette, name = "–ü–µ—Ä–µ–≤—ñ–∑–Ω–∏–∫") &
theme(legend.position = "bottom")
combined_plot
month_plot <- ggplot(monthly_summary,
aes(x = factor(month_name, levels = month.abb),
y = avg_fare, group = vendor_name)) +
geom_line(linewidth = 1) +
geom_point(size = 2) +
geom_text(aes(label = round(avg_fare, 2)), vjust = -0.5, size = 3) +
labs(title = "–°–µ—Ä–µ–¥–Ω—è –æ–ø–ª–∞—Ç–∞ –ø–æ –º—ñ—Å—è—Ü—è—Ö", x = "–ú—ñ—Å—è—Ü—å", y = "–°–µ—Ä–µ–¥–Ω—è –æ–ø–ª–∞—Ç–∞") +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position = "none")
season_plot <- ggplot(season_summary,
aes(x = factor(season, levels = c("Winter", "Spring", "Summer", "Autumn")),
y = avg_fare, group = vendor_name)) +
geom_line(linewidth = 1) +
geom_point(size = 2) +
geom_text(aes(label = round(avg_fare, 2)), vjust = -1, size = 3) +
labs(x = "–°–µ–∑–æ–Ω", y = "–°–µ—Ä–µ–¥–Ω—è –æ–ø–ª–∞—Ç–∞") +
theme_minimal()
# ‚¨áÔ∏è –æ–±‚Äô—î–¥–Ω–∞–Ω–Ω—è –∑ –æ–¥–Ω—ñ—î—é –ª–µ–≥–µ–Ω–¥–æ—é
combined_plot <- month_plot / season_plot +
plot_layout(guides = "collect") &
scale_color_manual(values = color_palette, name = "–ü–µ—Ä–µ–≤—ñ–∑–Ω–∏–∫") &
theme(legend.position = "bottom")
combined_plot
month_plot <- ggplot(monthly_summary,
aes(x = factor(month_name, levels = month.abb),
y = avg_fare, group = vendor_name, color = vendor_name)) +
geom_line(linewidth = 1) +
geom_point(size = 2) +
geom_text(aes(label = round(avg_fare, 2)), vjust = -0.5, size = 3) +
labs(title = "–°–µ—Ä–µ–¥–Ω—è –æ–ø–ª–∞—Ç–∞ –ø–æ –º—ñ—Å—è—Ü—è—Ö", x = "–ú—ñ—Å—è—Ü—å", y = "–°–µ—Ä–µ–¥–Ω—è –æ–ø–ª–∞—Ç–∞") +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position = "none")
season_plot <- ggplot(season_summary,
aes(x = factor(season, levels = c("Winter", "Spring", "Summer", "Autumn")),
y = avg_fare, group = vendor_name)) +
geom_line(linewidth = 1) +
geom_point(size = 2) +
geom_text(aes(label = round(avg_fare, 2)), vjust = -1, size = 3) +
labs(x = "–°–µ–∑–æ–Ω", y = "–°–µ—Ä–µ–¥–Ω—è –æ–ø–ª–∞—Ç–∞") +
theme_minimal()
# ‚¨áÔ∏è –æ–±‚Äô—î–¥–Ω–∞–Ω–Ω—è –∑ –æ–¥–Ω—ñ—î—é –ª–µ–≥–µ–Ω–¥–æ—é
combined_plot <- month_plot / season_plot +
plot_layout(guides = "collect") &
scale_color_manual(values = color_palette, name = "–ü–µ—Ä–µ–≤—ñ–∑–Ω–∏–∫") &
theme(legend.position = "bottom")
combined_plot
season_plot <- ggplot(season_summary,
aes(x = factor(season, levels = c("Winter", "Spring", "Summer", "Autumn")),
y = avg_fare, group = vendor_name, color = vendor_name)) +
geom_line(linewidth = 1) +
geom_point(size = 2) +
geom_text(aes(label = round(avg_fare, 2)), vjust = -1, size = 3) +
labs(x = "–°–µ–∑–æ–Ω", y = "–°–µ—Ä–µ–¥–Ω—è –æ–ø–ª–∞—Ç–∞") +
theme_minimal()
# ‚¨áÔ∏è –æ–±‚Äô—î–¥–Ω–∞–Ω–Ω—è –∑ –æ–¥–Ω—ñ—î—é –ª–µ–≥–µ–Ω–¥–æ—é
combined_plot <- month_plot / season_plot +
plot_layout(guides = "collect") &
scale_color_manual(values = color_palette, name = "–ü–µ—Ä–µ–≤—ñ–∑–Ω–∏–∫") &
theme(legend.position = "bottom")
combined_plot
month_plot <- ggplot(monthly_summary,
aes(x = factor(month_name, levels = month.abb),
y = avg_fare, group = vendor_name, color = vendor_name)) +
geom_line(linewidth = 1) +
geom_point(size = 2) +
geom_text(aes(label = round(avg_fare, 2)), vjust = -0.5, size = 3) +
labs(title = "–°–µ—Ä–µ–¥–Ω—è –æ–ø–ª–∞—Ç–∞ –ø–æ –º—ñ—Å—è—Ü—è—Ö", x = "–ú—ñ—Å—è—Ü—å", y = "–°–µ—Ä–µ–¥–Ω—è –æ–ø–ª–∞—Ç–∞") +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
season_plot <- ggplot(season_summary,
aes(x = factor(season, levels = c("Winter", "Spring", "Summer", "Autumn")),
y = avg_fare, group = vendor_name, color = vendor_name)) +
geom_line(linewidth = 1) +
geom_point(size = 2) +
geom_text(aes(label = round(avg_fare, 2)), vjust = -1, size = 3) +
labs(x = "–°–µ–∑–æ–Ω", y = "–°–µ—Ä–µ–¥–Ω—è –æ–ø–ª–∞—Ç–∞") +
theme_minimal()
# ‚¨áÔ∏è –æ–±‚Äô—î–¥–Ω–∞–Ω–Ω—è –∑ –æ–¥–Ω—ñ—î—é –ª–µ–≥–µ–Ω–¥–æ—é
combined_plot <- month_plot / season_plot +
plot_layout(guides = "collect") &
scale_color_manual(values = color_palette, name = "–ü–µ—Ä–µ–≤—ñ–∑–Ω–∏–∫") &
theme(legend.position = "bottom")
combined_plot
library(cowplot)
install.packages('cowplot')
library(cowplot)
color_palette <- c("darkorange", "steelblue")
month_plot <- ggplot(monthly_summary,
aes(x = factor(month_name, levels = month.abb),
y = avg_fare, group = vendor_name, color = vendor_name)) +
geom_line(linewidth = 1) +
geom_point(size = 2) +
geom_text(aes(label = round(avg_fare, 2)), vjust = -0.5, size = 3) +
scale_color_manual(values = color_palette, name = "–ü–µ—Ä–µ–≤—ñ–∑–Ω–∏–∫") +
labs(title = "–°–µ—Ä–µ–¥–Ω—è –æ–ø–ª–∞—Ç–∞ –ø–æ –º—ñ—Å—è—Ü—è—Ö", x = "–ú—ñ—Å—è—Ü—å", y = "–°–µ—Ä–µ–¥–Ω—è –æ–ø–ª–∞—Ç–∞") +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1),
legend.position = "none")   # –ø—Ä–∏–±–∏—Ä–∞—î–º–æ –∑–≤—ñ–¥—Å–∏
season_plot <- ggplot(season_summary,
aes(x = factor(season, levels = c("Winter", "Spring", "Summer", "Autumn")),
y = avg_fare, group = vendor_name, color = vendor_name)) +
geom_line(linewidth = 1) +
geom_point(size = 2) +
geom_text(aes(label = round(avg_fare, 2)), vjust = -1, size = 3) +
scale_color_manual(values = color_palette, name = "–ü–µ—Ä–µ–≤—ñ–∑–Ω–∏–∫") +
labs(x = "–°–µ–∑–æ–Ω", y = "–°–µ—Ä–µ–¥–Ω—è –æ–ø–ª–∞—Ç–∞") +
theme_minimal() +
theme(legend.position = "bottom")
# ---- –¢—Ä—é–∫ —ñ–∑ cowplot ----
# 1Ô∏è‚É£ –í–∏—Ç—è–≥—É—î–º–æ –ª–µ–≥–µ–Ω–¥—É –∑ –æ–¥–Ω–æ–≥–æ –≥—Ä–∞—Ñ—ñ–∫–∞
legend <- get_legend(season_plot)
# 2Ô∏è‚É£ –ü—Ä–∏–±–∏—Ä–∞—î–º–æ –ª–µ–≥–µ–Ω–¥–∏ –∑ –æ–±–æ—Ö –≥—Ä–∞—Ñ—ñ–∫—ñ–≤
month_plot <- month_plot + theme(legend.position = "none")
season_plot <- season_plot + theme(legend.position = "none")
# 3Ô∏è‚É£ –ö–æ–º–±—ñ–Ω—É—î–º–æ –≥—Ä–∞—Ñ—ñ–∫–∏ + –ª–µ–≥–µ–Ω–¥—É –≤–Ω–∏–∑—É
combined_plot <- plot_grid(
plot_grid(month_plot, season_plot, ncol = 1, align = "v"),
legend,
ncol = 1,
rel_heights = c(1, 0.1)
)
combined_plot
# 3Ô∏è‚É£ –ö–æ–º–±—ñ–Ω—É—î–º–æ –≥—Ä–∞—Ñ—ñ–∫–∏ + –ª–µ–≥–µ–Ω–¥—É –≤–Ω–∏–∑—É
combined_plot <- plot_grid(
plot_grid(month_plot, season_plot, ncol = 1, align = "v"),
legend,
ncol = 1,
rel_heights = c(1, 0.15)
)
combined_plot
# 3Ô∏è‚É£ –ö–æ–º–±—ñ–Ω—É—î–º–æ –≥—Ä–∞—Ñ—ñ–∫–∏ + –ª–µ–≥–µ–Ω–¥—É –≤–Ω–∏–∑—É
combined_plot <- plot_grid(
plot_grid(month_plot, season_plot, ncol = 1, align = "v"),
legend,
ncol = 1,
rel_heights = c(1, 0.2)
)
combined_plot
# 3Ô∏è‚É£ –ö–æ–º–±—ñ–Ω—É—î–º–æ –≥—Ä–∞—Ñ—ñ–∫–∏ + –ª–µ–≥–µ–Ω–¥—É –≤–Ω–∏–∑—É
combined_plot <- plot_grid(
plot_grid(month_plot, season_plot, ncol = 1, align = "v"),
legend,
ncol = 1,
rel_heights = c(1, 0.15)
)
combined_plot
combined_plot <- plot_grid(
plot_grid(month_plot, season_plot, ncol = 1, align = "v"),
legend,
ncol = 1,
rel_heights = c(1, 0.18)   # –∞–±–æ 0.2
)
combined_plot
combined_plot <- plot_grid(
plot_grid(month_plot, season_plot, ncol = 1, align = "v"),
legend,
ncol = 1,
rel_heights = c(1, 0.1)   # –∞–±–æ 0.2
)
combined_plot
combined_plot <- plot_grid(
plot_grid(month_plot, season_plot, ncol = 1, align = "v"),
legend,
ncol = 1,
rel_heights = c(1, 0.01)   # –∞–±–æ 0.2
)
combined_plot
# ‚¨áÔ∏è –æ–±‚Äô—î–¥–Ω–∞–Ω–Ω—è –∑ –æ–¥–Ω—ñ—î—é –ª–µ–≥–µ–Ω–¥–æ—é
combined_plot <- month_plot / season_plot +
plot_layout(guides = "collect") &
scale_color_manual(values = color_palette, name = "–ü–µ—Ä–µ–≤—ñ–∑–Ω–∏–∫") &
theme(legend.position = "bottom")
combined_plot
# ‚¨áÔ∏è –æ–±‚Äô—î–¥–Ω–∞–Ω–Ω—è –∑ –æ–¥–Ω—ñ—î—é –ª–µ–≥–µ–Ω–¥–æ—é
combined_plot <- month_plot / season_plot +
plot_layout(guides = "collect") &
theme(legend.position = "bottom")
combined_plot
month_plot <- ggplot(monthly_summary,
aes(x = factor(month_name, levels = month.abb),
y = avg_fare, group = vendor_name, color = vendor_name)) +
geom_line(linewidth = 1) +
geom_point(size = 2) +
geom_text(aes(label = round(avg_fare, 2)), vjust = -0.5, size = 3) +
labs(title = "–°–µ—Ä–µ–¥–Ω—è –æ–ø–ª–∞—Ç–∞ –ø–æ –º—ñ—Å—è—Ü—è—Ö", x = "–ú—ñ—Å—è—Ü—å", y = "–°–µ—Ä–µ–¥–Ω—è –æ–ø–ª–∞—Ç–∞") +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
season_plot <- ggplot(season_summary,
aes(x = factor(season, levels = c("Winter", "Spring", "Summer", "Autumn")),
y = avg_fare, group = vendor_name, color = vendor_name)) +
geom_line(linewidth = 1) +
geom_point(size = 2) +
geom_text(aes(label = round(avg_fare, 2)), vjust = -1, size = 3) +
labs(x = "–°–µ–∑–æ–Ω", y = "–°–µ—Ä–µ–¥–Ω—è –æ–ø–ª–∞—Ç–∞") +
theme_minimal()
# ‚¨áÔ∏è –æ–±‚Äô—î–¥–Ω–∞–Ω–Ω—è –∑ –æ–¥–Ω—ñ—î—é –ª–µ–≥–µ–Ω–¥–æ—é
combined_plot <- month_plot / season_plot +
plot_layout(guides = "collect") &
theme(legend.position = "bottom")
combined_plot
month_plot <- ggplot(monthly_summary,
aes(x = factor(month_name, levels = month.abb),
y = avg_fare, group = vendor_name, color = vendor_name)) +
geom_line(linewidth = 1) +
geom_point(size = 2) +
geom_text(aes(label = round(avg_fare, 2)), vjust = -0.5, size = 3) +
labs(title = "–°–µ—Ä–µ–¥–Ω—è –æ–ø–ª–∞—Ç–∞ –ø–æ –º—ñ—Å—è—Ü—è—Ö", x = "–ú—ñ—Å—è—Ü—å", y = "–°–µ—Ä–µ–¥–Ω—è –æ–ø–ª–∞—Ç–∞") +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position = 'none')
season_plot <- ggplot(season_summary,
aes(x = factor(season, levels = c("Winter", "Spring", "Summer", "Autumn")),
y = avg_fare, group = vendor_name, color = vendor_name)) +
geom_line(linewidth = 1) +
geom_point(size = 2) +
geom_text(aes(label = round(avg_fare, 2)), vjust = -1, size = 3) +
labs(x = "–°–µ–∑–æ–Ω", y = "–°–µ—Ä–µ–¥–Ω—è –æ–ø–ª–∞—Ç–∞") +
theme_minimal()
# ‚¨áÔ∏è –æ–±‚Äô—î–¥–Ω–∞–Ω–Ω—è –∑ –æ–¥–Ω—ñ—î—é –ª–µ–≥–µ–Ω–¥–æ—é
combined_plot <- month_plot / season_plot +
plot_layout(guides = "collect") &
theme(legend.position = "bottom")
combined_plot
season_plot <- ggplot(season_summary,
aes(x = factor(season, levels = c("Winter", "Spring", "Summer", "Autumn")),
y = avg_fare, group = vendor_name, color = vendor_name)) +
geom_line(linewidth = 1) +
geom_point(size = 2) +
geom_text(aes(label = round(avg_fare, 2)), vjust = -1, size = 3) +
labs(x = "–°–µ–∑–æ–Ω", y = "–°–µ—Ä–µ–¥–Ω—è –æ–ø–ª–∞—Ç–∞") +
theme_minimal()+
theme(legend.position = 'none')
# ‚¨áÔ∏è –æ–±‚Äô—î–¥–Ω–∞–Ω–Ω—è –∑ –æ–¥–Ω—ñ—î—é –ª–µ–≥–µ–Ω–¥–æ—é
combined_plot <- month_plot / season_plot +
plot_layout(guides = "collect") &
theme(legend.position = "bottom")
combined_plot
month_plot <- ggplot(monthly_summary,
aes(x = factor(month_name, levels = month.abb),
y = avg_fare, group = vendor_name, color = vendor_name)) +
geom_line(linewidth = 1) +
geom_point(size = 2) +
geom_text(aes(label = round(avg_fare, 2)), vjust = -0.5, size = 3) +
labs(title = "–°–µ—Ä–µ–¥–Ω—è –æ–ø–ª–∞—Ç–∞ –ø–æ –º—ñ—Å—è—Ü—è—Ö", x = "–ú—ñ—Å—è—Ü—å", y = "–°–µ—Ä–µ–¥–Ω—è –æ–ø–ª–∞—Ç–∞") +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position = 'none')
season_plot <- ggplot(season_summary,
aes(x = factor(season, levels = c("Winter", "Spring", "Summer", "Autumn")),
y = avg_fare, group = vendor_name, color = vendor_name)) +
geom_line(linewidth = 1) +
geom_point(size = 2) +
geom_text(aes(label = round(avg_fare, 2)), vjust = -1, size = 3) +
labs(x = "–°–µ–∑–æ–Ω", y = "–°–µ—Ä–µ–¥–Ω—è –æ–ø–ª–∞—Ç–∞") +
theme_minimal()
# ‚¨áÔ∏è –æ–±‚Äô—î–¥–Ω–∞–Ω–Ω—è –∑ –æ–¥–Ω—ñ—î—é –ª–µ–≥–µ–Ω–¥–æ—é
combined_plot <- month_plot / season_plot +
theme(legend.position = "bottom")
combined_plot
#| label: setup
#| include: false
library(pacman)
p_load(
arrow,
duckplyr, warn.conflicts = FALSE,
dplyr,
tidyr,
ggplot2,
plotly,
patchwork
)
#| code-fold: true
nyc <- read_parquet_duckdb("D:/Anna Akhlamova/Rsomedatasettaxi/nyc-taxi/**/*.parquet")
rate_code_count <- nyc |>
filter(!is.na(rate_code)) |>
count(rate_code) |>
arrange(desc(n))
rate_code_count
str(nyc$pickup_datetime)
class(nyc$pickup_datetime)
nyc_peaks <- nyc |>
select(pickup_datetime, month) |>
filter(!is.na(pickup_datetime), !is.na(month)) |>
collect() |>
mutate(
season = case_when(
month %in% c(12, 1, 2)  ~ "Winter",
month %in% c(3, 4, 5)   ~ "Spring",
month %in% c(6, 7, 8)   ~ "Summer",
month %in% c(9, 10, 11) ~ "Autumn"
),
hour = hour(pickup_datetime),
day_of_week = wday(pickup_datetime, label = TRUE)
)
hourly_all <- nyc_peaks |>
group_by(season, hour) |>
summarise(n_trips = n(), .groups = "drop")
daily_all <- nyc_peaks |>
group_by(season, day_of_week) |>
summarise(n_trips = n(), .groups = "drop")
hour_plot <- ggplot(hourly_all, aes(x = factor(hour), y = n_trips, fill = season)) +
geom_col(position = "dodge") +
labs(title = "–ü—ñ–∫–æ–≤—ñ –≥–æ–¥–∏–Ω–∏ –ø–æ —Å–µ–∑–æ–Ω–∞—Ö", x = "–ì–æ–¥–∏–Ω–∞", y = "–ö—ñ–ª—å–∫—ñ—Å—Ç—å –ø–æ—ó–∑–¥–æ–∫") +
theme_minimal() +
scale_fill_manual(values = c("tan1", "palegreen", "khaki1", "lightblue1"))
day_plot <- ggplot(daily_all, aes(x = day_of_week, y = n_trips, fill = season)) +
geom_col(position = "dodge") +
labs(title = "–ü—ñ–∫–æ–≤—ñ –¥–Ω—ñ —Ç–∏–∂–Ω—è –ø–æ —Å–µ–∑–æ–Ω–∞—Ö", x = "–î–µ–Ω—å —Ç–∏–∂–Ω—è", y = "–ö—ñ–ª—å–∫—ñ—Å—Ç—å –ø–æ—ó–∑–¥–æ–∫") +
theme_minimal() +
scale_fill_manual(values = c("tan1", "palegreen", "khaki1", "lightblue1"))
peak_plot <- hour_plot / day_plot + plot_layout(guides = "collect") &
theme(legend.position = "bottom")
combined_plot
peak_plot
combined_plot
peak_plot
